{% extends "index.html" %}
{% load static %}
{% block main-content %}
<main>
    <div class="nxPaddingPage">
        <div class="container text-center">
            <h1 class="">Danh Sách Đơn Hàng</h1>
            <div style="overflow: auto;" class="">
                <table>
                    <thead>
                        <tr  style="background-color:rgba(0,0,0,0.05)">
                            <th >STT</th>
                            <th >ID</th>
                            <th >Tên khác hàng</th>
                            <th >Trạng Thái</th>
                            <th >Thời Gian</th>
                            <th >Loại / Số lượng</th>
                            <th >Tổng Tiền</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in listOrder %}
                            <tr id="{{ item.id }}" onclick="openDetail(this)"  style="background-color:rgba(255, 255, 255, 0.05)" >
                                <td>{{ forloop.counter }}</td>
                                <td>{{ item.id }}</td>
                                <td>{{ item.username }}</td>                           
                                <td>
                                    {% if item.status == "waiting" %}
                                    Đang chờ xác nhận
                                    {% elif item.status == "processing" %}
                                    Đang xử lý
                                    {% elif item.status == "shipping" %}
                                    Đang giao hàng
                                    {% endif %}
                                </td>
                                <td>{{ item.createtime }}</td>
                                <td >
                                    {% for product in item.dataOder %}
                                    <div>
                                        <p>
                                            <strong>{{ product.type }}</strong>
                                            <span>x {{ product.quantity }}</span>
                                        </p>
                                    </div>
                                    {% endfor %}
                                </td>
                                <td  > <span class="total">{{ item.total}}</span>đ</td>
                          </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</main>
<script>
    let listOrder = [
        {% for item in listOrder %}
        {
            "id" : "{{ item.id }}",
            "username" : "{{ item.username }}",
            "total" : "{{ item.total }}",
            "status" : "{{ item.status }}",
            "createtime" : "{{ item.createtime }}",
            "dataOder" : {{ item.dataOder|safe }}
            },
        {% endfor %}
    ];
    document.addEventListener('DOMContentLoaded', () => {
    let spanTotals = document.querySelectorAll(".total");
    spanTotals.forEach(span => {
        let number = parseFloat(span.textContent.replace(/[^0-9.-]/g, '')); // Loại bỏ ký tự không phải số
        if (!isNaN(number)) {
            span.textContent = number.toLocaleString('vi-VN'); // Định dạng số
        }
    });
});
    const openDetail = (e)=>{
        console.log(e.id)
        window.location.href = '/detail-order/' + e.id;
    }
</script>
{% endblock main-content %}